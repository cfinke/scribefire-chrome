<!DOCTYPE html>
<html>
	<head>
		<title>ScribeFire</title>
		<link rel="stylesheet" type="text/css" href="skin/base.css" />
		<link rel="stylesheet" type="text/css" href="skin/widgets.css" />
		<link rel="stylesheet" type="text/css" href="skin/style.css" />
		<link rel="stylesheet" type="text/css" href="skin/facebox.css" />
		<script type="text/javascript" src="util.js"></script>
		<script type="text/javascript" src="xmlrpc.js"></script>
		<script type="text/javascript" src="apis.js"></script>
		<script type="text/javascript" src="scribefire.js"></script>
		<script type="text/javascript" src="lib/jquery.js"></script>
		<script type="text/javascript" src="lib/jquery-resize.js"></script>
		<script type="text/javascript" src="lib/parseUri.js"></script>
		<script type="text/javascript" src="lib/facebox.js"></script>
		<script type="text/javascript" src="lib/tiny_mce/tiny_mce_src.js"></script>
		<script type="text/javascript" src="lib/persist.js"></script>
		<script type="text/javascript" src="lib/keyboard.js"></script>
		<script type="text/javascript" src="lib/wordpress.js"></script>
		<script type="text/javascript" src="migrate.js"></script>
	</head>
	<body style="width: 100%;">
		<table style="width: 100%;" cellspacing="0" cellpadding="0">
			<tr>
				<td id="main" style="width: 100%;">
					<div id="ui-blogs">
						<div class="bar bar-selected" id="bar-blog">
							<label>Blog: <span id="label-current-blog"></span></label>
							<a href="#" style="float: right; padding-right: 1ex;" class="trap" id="link-help">HELP!</a>
						</div>
						<div class="underbar underbar-selected" id="underbar-blog">
							<div>
								<select id="list-blogs"></select>
							</div>
							<p>
								<button id="button-blog-add">Add a New Blog</button>
								<button id="button-blog-remove">Remove</button>
								<button id="button-inlinks">$$$</button>
							</p>
							<div id="dialog-blog-add" style="display:none;">
								<div class="step-1">
									<div class="subbar subbar-selected">
										<label>URL: <span id="label-add-blog-url"></span></label>
									</div>
									<div class="subunderbar subunderbar-selected">
										<input type="url" id="text-blog-url" accept="button-blog-urlcheck" cancel="button-addblog-cancel" />
										<p>
											<button id="button-blog-urlcheck">Next</button>
											<button id="button-addblog-cancel">Cancel</button>
										</p>
									</div>
								</div>
								<div class="step-2">
									<div class="subbar">
										<label>Blog Type: <span id="label-add-blog-type"></span></label>
									</div>
									<div class="subunderbar">
										<select id="list-blog-types">
											<option vlaue="">(select)</option>
											<option value="atom">Atom</option>
											<option value="blogger">Blogger</option>
											<option value="wordpress">Wordpress</option>
											<option value="tumblr">Tumblr</option>
											<option value="metaweblog" requires_id="true">MetaWeblog</option>
											<option value="movabletype" requires_id="true">MovableType</option>
											<option value="posterous">Posterous</option>
										</select>
									</div>
								</div>
								<div class="step-2">
									<div class="subbar">
										<label>API URL: <span id="label-add-blog-apiurl"></span></label>
									</div>
									<div class="subunderbar">
										<input type="url" id="text-blog-api-url" value="" />
									</div>
									<div id="text-addblog-id-container" style="display: none;">
										<div class="subbar">
											<label>Blog ID: <span id="label-add-blog-blogid"></span><label>
										</div>
										<div class="subunderbar">
											<input type="text" id="text-addblog-id" />
										</div>
									</div>
								</div>
								<div class="step-2">
									<div class="subbar">
										<label>Login Credentials</label>
									</div>
									<div class="subunderbar">
										<label>Username</label>
										<input type="text" id="text-blog-username" accept="button-blog-logincheck" />
										<label>Password</label>
										<input type="password" id="text-blog-password" accept="button-blog-logincheck" />
										<p>
											<button id="button-blog-logincheck">Finish</button>
										</p>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="ui-entries">
						<div class="bar" id="bar-entries">
							<label>Entry: <span id="label-current-entry"></span></label>
						</div>
						<div class="underbar" id="underbar-entries">
							<select id="list-entries"><option value="">(new)</option></select>
							<span id="ui-deleteEntry">
								<button id="button-entry-remove" style="display: none;">Delete Post</button>
							</span>
						</div>
					</div>
					<div id="ui-title">
						<div class="bar bar-selected" id="bar-title">
							<label>Title: <span id="label-current-title"></span></label>
						</div>
						<div class="underbar underbar-selected" id="underbar-title">
							<input type="text" id="text-title" />
						</div>
					</div>
					<div id="ui-content">
						<div class="bar bar-selected" id="bar-content">
							<label>Post Content</label>
							<div id="editor-toggles" style="float: right; padding-right: 1ex; cursor: pointer;" class="trap">
								<a id="edButtonHTML" onclick="event.stopPropagation(); switchEditors.go('text-content', 'html');">Switch to HTML Mode</a>
								<a id="edButtonPreview" style="display: none;" onclick="event.stopPropagation(); switchEditors.go('text-content', 'tinymce');">Switch to Visual Editor</a>
							</div>
						</div>
						<div class="underbar underbar-selected" id="underbar-content">
							<textarea rows="10" name="text-content" id="text-content"></textarea>
						</div>
					</div>
					<div id="ui-categories">
						<div class="bar" id="bar-categories">
							<label>Categories: <span id="label-current-categories"></span></label>
						</div>
						<div class="underbar" id="underbar-categories">
							<select id="list-categories" multiple="true"></select>
							<button id="button-category-add">New Category</button>
						</div>
					</div>
					<div id="ui-tags">
						<div class="bar" id="bar-tags">
							<label>Tags: <span id="label-current-tags"></span></label>
						</div>
						<div class="underbar" id="underbar-tags">
							<input type="text" id="text-tags" placeholder="Comma-separated"/>
						</div>
					</div>
				</td>
				<td id="sidebar" style="width: 0%;"></td>
			</tr>
		</table>
		<div id="ui-publish">
			<div class="bar bar-selected" id="bar-publish">
				<label>Publish</label>
			</div>
			<div class="underbar underbar-selected" id="underbar-publish">
				<div style="text-align: right; float: right;">
					<button id="reset-button">Clear All Fields</button>
				</div>
				<input type="checkbox" id="checkbox-draft" /> <label>Draft</label>
				<span id="ui-private" style="padding: 0 0 0 1em;">
					<input type="checkbox" id="checkbox-private" /> <label>Private</label>
				</span>
				<span id="ui-slug" style="padding: 0 0 0 1em;">
					<a href="#" id="slug-toggle">Permalink</a>: 
					<input type="url" style="width: 15em; display: none;" id="text-slug" />
					<span id="slug-display"></span>
				</span>
				<span id="ui-timestamp" style="padding: 0 0 0 1em;">
					<a href="#" id="toggle-schedule">Schedule</a>:
					<span id="toggle-schedule-immediately">Right now</span>
					<span id="toggle-schedule-scheduled" style="display:none; border: 2px inset; padding: 1px;">
						<input type="number" id="text-timestamp-year" size="5" style="border: 0;" placeholder="YYYY" min="0000" max="99999" />/<input type="number" id="text-timestamp-month" size="3" style="border: 0;" placeholder="MM" min="01" max="12" />/<input type="number" id="text-timestamp-day" size="3" style="border: 0;" placeholder="DD" min="01" max="31"/>
						<input type="number" id="text-timestamp-hour" size="3" style="border: 0;" placeholder="HH" min="00" max="23" />:<input type="number" id="text-timestamp-minute" size="3" style="border: 0;" placeholder="mm" min="00" max="59" />
					</span>
				</span>
				<button id="button-publish" style="margin-left: 1em;">Publish Post</button>
			</div>
		</div>
		<div id="panel-inlinks" style="display: none;">
			<image src="skin/inlinks.png" />

			<p>ScribeFire has partnered with <a href="http://www.inlinks.com/?ref=240364" target="_blank">InLinks.com</a> to provide you with an easy-to-use monetization solution for your blog. Out of the blogs you have set up in ScribeFire, the following may be compatible with InLinks:</p>
			<ul id="list-inlinks-blogs"></ul>

			<h3>What are InLinks?</h3>
			<p>InLinks are static HTML advertisements located within content areas of websites.  It is simply the most natural paid link on the market.  The benefits for you are:</p>

			<ul>
				<li>Ads that are easy on the eyes.  No annoying pop-ups!</li>
				<li>Predictable revenue. Get paid a flat rate/month/ad sold.</li>
				<li>Blog-friendly. Install our simple plugin and we take care of the rest.  Just sit back and collect your monthly earnings.</li>
			</ul>

			<p>(For now, InLinks only works on blogs using Wordpress.org, Drupal, or MovableType.)</p>
			<p><a href="http://www.inlinks.com/?ref=240364" target="_blank">Visit InLinks.com</a> to download the InLinks plugin and start earning money on your blogs today!</p>
		</div>
		
		<script>
			var editor = {
				val : function (new_val) {
					if (typeof new_val != 'undefined') {
						if (switchEditors.mode == 'tinymce') {
							tinyMCE.get('text-content').setContent(new_val);
						}
						else {
							$("#text-content").val(switchEditors._wp_Nop(new_val));
						}
					}
					else {
						if (switchEditors.mode == 'tinymce') {
							return tinyMCE.get('text-content').getContent();
						}
						else {
							return switchEditors._wp_Autop($("#text-content").val());
						}
					}
				}
			};
			
			var accountWizardBlog = {};
			
			function getTimestamp() {
				if ($("#text-timestamp-year").val() === "" || $("#text-timestamp-month").val() === "" || $("#text-timestamp-day").val() === "" || $("#text-timestamp-hour").val() === "" || $("#text-timestamp-minute").val() === "") {
					return false;
				}
				else {
					return Math.max(1000, $("#text-timestamp-year").val()) + "-" + pad(Math.max(1, $("#text-timestamp-month").val())) + "-" + pad(Math.max(1, $("#text-timestamp-day").val())) + " " + pad(Math.max(0, $("#text-timestamp-hour").val())) + ":" + pad(Math.max(0, $("#text-timestamp-minute").val())) + ":00";
				}
			}
			
			function setTimestamp(date) {
				if (date instanceof Date) {
					date = phpdate(date, "Y-m-d H:i");
				}
				
				if (date) {
					var parts = date.split(/[^0-9]/);
					
					$("#text-timestamp-year").val(parts[0]);
					$("#text-timestamp-month").val(parts[1]);
					$("#text-timestamp-day").val(parts[2]);
					$("#text-timestamp-hour").val(parts[3]);
					$("#text-timestamp-minute").val(parts[4]);
				}
				else {
					$("#text-timestamp-year").val("");
					$("#text-timestamp-month").val("");
					$("#text-timestamp-day").val("");
					$("#text-timestamp-hour").val("");
					$("#text-timestamp-minute").val("");
				}
			}
			
			$(document).ready(function () {
				$("#text-slug").change(function () {
					if ($(this).val()) {
						$("#slug-display").html($(this).val());
					}
					else {
						$("#slug-display").html("Automatic");
					}
				});
				
				$("#slug-toggle").live("click", function (e) {
					e.preventDefault();
					
					var slug = $("#text-slug");
					
					if (slug.is(":visible")) {
						slug.hide();
						$("#slug-display").show();
					}
					else {
						$("#slug-display").hide();
						slug.show();
					}
				});
				
				$(".trap").live("click", function (e) {
					e.preventDefault();
					e.stopPropagation();
				});
				
				$("#link-help").live("click", function (e) {
					$.facebox("<div><h2>How can I help you?</h2><p>If you found a bug, <a href=\"https://code.google.com/p/scribefire-chrome/issues/entry?template=Defect%20report%20from%20user\" target=\"_blank\">fill out this form</a>.</p><p>If you want to request a feature, <a href=\"https://code.google.com/p/scribefire-chrome/issues/entry?template=Feature%20Request\" target=\"_blank\">fill out this form</a>.</p><p>If you need help using ScribeFire, you can <a href=\"mailto:chris@scribefire.com\">email chris@scribefire.com</a>.</p><p>If you just want to talk, you can ping <a href=\"http://twitter.com/scribefire\" target=\"_blank\">@scribefire</a> on Twitter.</p></div>");
				});
				
				$("#toggle-schedule").live("click", function (e) {
					e.preventDefault();
					
					$("#toggle-schedule-immediately").toggle();
					$("#toggle-schedule-scheduled").toggle();
				});
				
				$("#list-blog-types").change(function (e) {
					var option = $(this).find("option:selected");
					
					if (option.attr("requires_id") == "true") {
						$("#text-addblog-id-container").show();
					}
					else {
						$("#text-addblog-id-container").hide();
					}
				});
				
				$("#button-category-add").live("click", function (e) {
					e.preventDefault();
					
					var button = $(this);
					button.addClass("busy");
					
					var categoryName = prompt("New category name:");
					
					if (categoryName) {
						function callback() {
							button.removeClass("busy");
						}
						
						SCRIBEFIRE.addCategory(categoryName, callback, callback);
					}
					else {
						button.removeClass("busy");
					}
				});
				
				$("#reset-button").live("click", function (e) {
					e.preventDefault();
					
					SCRIBEFIRE.clearData();
				});
				
				$("#button-addblog-cancel").live("click", function (e) {
					e.preventDefault();
					
					$("#dialog-blog-add").hide();	
					
					// @todo Cancel any requests.
					$("#button-blog-urlcheck").removeClass("busy");
				});
				
				$("#button-blog-remove").live("click", function (e) {
					e.preventDefault();
					
					if (confirm("Are you sure?")) {
						SCRIBEFIRE.removeBlog($("#list-blogs").val());
					}
				});
				
				$("#button-entry-remove").live("click", function (e){
					e.preventDefault();
					
					var button = $(this);
					button.addClass("busy");
					
					if (confirm("Are you sure?")) {
						function callback() {
							button.removeClass("busy");
						}
						
						SCRIBEFIRE.deletePost(
							$("#list-entries").val(),
							function success() {
								SCRIBEFIRE.notify("Post deleted successfully.");
								
								SCRIBEFIRE.clearData();
								
								button.removeClass("busy");
							},
							function failure() {
								button.removeClass("busy");
							}
						);
					}
				});
				
				$(".bar").live("click", function () {
					if ($(this).attr("disabled") != "true") {
						if ($(this).hasClass("bar-selected")) {
							$(this).removeClass("bar-selected");
							$(this).parent().find(".underbar:first").removeClass("underbar-selected");
						}
						else {
							$(this).addClass("bar-selected");
							$(this).parent().find(".underbar:first").addClass("underbar-selected");
						}
					}
					
					$(this).persist("class");
					$(this).parent().find(".underbar:first").persist("class");
				});

				$(".subbar").live("click", function () {
					if ($(this).attr("disabled") != "true") {
						$(this).parent().find(".subunderbar:first").toggle();
					
						if ($(this).hasClass("subbar-selected")) {
							$(this).removeClass("subbar-selected");
						}
						else {
							$(this).addClass("subbar-selected");
						}
					}
				});
				
				$("#text-title").change(function () {
					$("#label-current-title").html($(this).val());
				});
				
				$("#text-tags").change(function () {
					$("#label-current-tags").html($(this).val());
				});
				
				$("#list-blogs").change(function () {
					$("#button-inlinks").hide();
					
					if (!$(this).val()) {
						$("#button-blog-edit, #button-blog-remove").hide();
					}
					else {
						$("#button-blog-edit, #button-blog-remove").show();
						SCRIBEFIRE.populateEntriesList();
						SCRIBEFIRE.populateCategoriesList();
						
						if ($(this).find("option:selected").data("type") == "wordpress") {
							$("#button-inlinks").show();
						}
					}
					
					SCRIBEFIRE.prefs.setCharPref("selectedBlog", $(this).val());
					$("#label-current-blog").html($(this).find("option:selected").text());
					
					SCRIBEFIRE.updateOptionalUI();
				});
				
				$("#list-entries").change(function () {
					var postId = $(this).val();
					
					if (!postId) {
						$("#button-entry-remove").hide();
						$("#button-publish").html("Publish Post");
					}
					else {
						$("#button-entry-remove").show();
						$("#button-publish").html("Publish Edited Post");
						
						if (!$(this).attr("ignoreContent")) {
							var entry = $(this).find("option:selected");
						
							$("#text-title").val(entry.data("title")).change();
							
							editor.val(entry.data("content"));
						
							// $("#text-content").val(entry.data("content"));
							$("#checkbox-draft").attr("checked", entry.data("published") == "false");
							$("#text-tags").val(entry.data("tags"));
							
							if (entry.data("timestamp") instanceof Date) {
								setTimestamp(entry.data("timestamp"));
								$("#toggle-schedule-immediately").hide();
								$("#toggle-schedule-scheduled").show();
							}
							else {
								setTimestamp();
								$("#toggle-schedule-immediately").show();
								$("#toggle-schedule-scheduled").hide();
							}
							
							$("#text-slug").val(entry.data("slug")).change();
							$("#checkbox-private").attr("checked", entry.data("private"));
							
							SCRIBEFIRE.getAPI().getPostCategories(
								{ "id" : postId },
								function success (categories) {
									$("#list-categories").val(categories).change();
								},
								function failure(rv) {
									rv.func = "getPostCategories";
									SCRIBEFIRE.genericError(rv);
								}
							);
						}
					}
					
					$("#label-current-entry").html($(this).find("option:selected").text());
				});
				
				$("#list-categories").change(function (e) {
					if (!$(this).val()) {
						$("#label-current-categories").html("(none)");
					}
					else {
						var categories = [];
						
						$(this).find("option:selected").each(function () {
							categories.push($(this).text());
						});
						
						$("#label-current-categories").html(categories.join(", "));
					}
				});
				
				$("#button-blog-add").live("click", function (e) {
					accountWizardBlog = {};
					
					$("#dialog-blog-add").show();
					
					$("#text-blog-url").val("").change();
					$("#list-blog-types").val("").change();
					$("#text-blog-api-url").val("");
					$("#text-blog-username").val("");
					$("#text-blog-password").val("");
					$("#text-addblog-id").val("");
					
					$("#dialog-blog-add .step-2 .subbar").removeClass("subbar-selected");
					$("#dialog-blog-add .step-2 .subunderbar").removeClass("subunderbar-selected");
					$("#dialog-blog-add .step-2").find("input, select");
					$("#dialog-blog-add .step-2 .subunderbar").hide();
					
					$("#text-blog-url").focus();
				});
				
				$("#button-blog-urlcheck").live("click", function (e) {
					var button = $(this);
					
					button.addClass("busy");
					
					$("#list-blog-types").val("").change();
					$("#text-blog-api-url").val("");
					$("#text-blog-username").val("");
					$("#text-blog-password").val("");
					$("#text-addblog-id").val("");
					
					SCRIBEFIRE.getBlogMetaData(
						$("#text-blog-url").val(),
						function (metaData) {
							button.removeClass("busy");
							
							$("#text-addblog-id-container").hide();
							
							accountWizardBlog = metaData;
							
							$("#list-blog-types").val(metaData.type).change();
							$("#list-blog-types").removeAttr("disabled");
							
							$("#text-blog-api-url").val(metaData.apiUrl);
							$("#text-blog-api-url").removeAttr("disabled");
							
							if (metaData.id) {
								$("#text-addblog-id").val(metaData.id);
							}
							else {
								$("#text-addblog-id").val("");
							}
							
							$("#dialog-blog-add .step-2 *[disabled]").removeAttr("disabled");
							
							$("#dialog-blog-add .step-2 .subbar").each(function () {
								if (!$(this).hasClass("subbar-selected")) {
									$(this).click();
								}
							});
							
							$("#text-blog-username").focus();
						},
						function failure(code, status) {
							button.removeClass("busy");
							
							var error = "While trying to determine your blog's settings, ScribeFire tripped over this code: " + code;
							
							if (code == "UNKNOWN_BLOG_TYPE") {
								error += "\n\nYou're welcome to try and configure your blog manually.";
								
								$("#list-blog-types").removeAttr("disabled");
								$("#text-blog-api-url").removeAttr("disabled");
								
								$("#dialog-blog-add .step-2 *[disabled]").removeAttr("disabled");
								
								$("#dialog-blog-add .step-2 .subbar").each(function () {
									if (!$(this).hasClass("subbar-selected")) {
										$(this).click();
									}
								});
							}
							
							SCRIBEFIRE.error(error);
						}
					);
				});
				
				$("#button-blog-logincheck").live("click", function (e) {
					var button = $(this);
					button.addClass("busy");
					
					var params = accountWizardBlog;
					
					params.apiUrl = $("#text-blog-api-url").val();
					params.type = $("#list-blog-types").val();
					params.username = $("#text-blog-username").val();
					params.password = $("#text-blog-password").val();
					params.blogUrl = $("#text-blog-url").val();
					
					if ("url" in params) {
						params.blogUrl = params.url;
						delete params.url;
					}
					
					if ($("#text-addblog-id").val()) {
						params.id = $("#text-addblog-id").val();
					}
					
					SCRIBEFIRE.getBlogs(
						params,
						function (rv) {
							button.removeClass("busy");
							
							$("#list-blogs").val(rv[0].username + "@" + rv[0].url).change();
							$("#dialog-blog-add").hide();
							SCRIBEFIRE.clearData();
							
							SCRIBEFIRE.notify("Your blog was added successfully!");
						},
						function (rv) {
							button.removeClass("busy");
						}
					);
				});
				
				$("#button-publish").live("click", function (e) {
					e.preventDefault();
					
					var button = $(this);
					button.addClass("busy");
					
					function callback() {
						button.removeClass("busy");
					}

					SCRIBEFIRE.publish(
						function success(rv) {
							button.removeClass("busy");
							SCRIBEFIRE.notify(
								"Post published successfully!", 
								"Open blog in a new tab",
								function (button) { 
									if (typeof chrome != 'undefined') {
										chrome.tabs.create({ "url": rv.url });
									}
									else {
										window.open(rv.url);
									}
								}
							);
						},
						function error(rv) {
							button.removeClass("busy");
						});
				});

				$("#button-inlinks").live("click", function (e) {
					e.preventDefault();
					
					$.facebox($("#panel-inlinks"));
					$("#panel-inlinks").show();
				});
				
				$(window).bind("beforeunload", function (e) {
					// Grab all of the input values for state persistence.
					SCRIBEFIRE.prefs.setCharPref("state.entryId", $("#list-entries").val());
					SCRIBEFIRE.prefs.setCharPref("state.title",   $("#text-title").val());
					SCRIBEFIRE.prefs.setCharPref("state.content", editor.val());
					SCRIBEFIRE.prefs.setCharPref("state.tags",	$("#text-tags").val());
					SCRIBEFIRE.prefs.setCharPref("state.timestamp",getTimestamp());
					SCRIBEFIRE.prefs.setBoolPref("state.draft",   $("#checkbox-draft").is(":checked"));
					SCRIBEFIRE.prefs.setJSONPref("state.categories", $("#list-categories").val());
					SCRIBEFIRE.prefs.setCharPref("state.slug", $("#text-slug").val());
				});
				
				$("#text-title").val(SCRIBEFIRE.prefs.getCharPref("state.title"));
				SCRIBEFIRE.prefs.setCharPref("state.title", "");
				
				$("#text-tags").val(SCRIBEFIRE.prefs.getCharPref("state.tags"));
				SCRIBEFIRE.prefs.setCharPref("state.tags", "");
				
				setTimestamp(SCRIBEFIRE.prefs.getCharPref("state.timestamp"));
				
				if (getTimestamp()) {
					$("#toggle-schedule-immediately").hide();
					$("#toggle-schedule-scheduled").show();
				}
				else {
					$("#toggle-schedule-immediately").show();
					$("#toggle-schedule-scheduled").hide();
				}
				
				SCRIBEFIRE.prefs.setCharPref("state.timestamp");
				
				$("#checkbox-draft").attr("checked", SCRIBEFIRE.prefs.getBoolPref("state.draft"));
				SCRIBEFIRE.prefs.setBoolPref("state.draft", false);
				
				$("#text-slug").val(SCRIBEFIRE.prefs.getCharPref("state.slug")).change();
				SCRIBEFIRE.prefs.setCharPref("state.slug", "");
				
				SCRIBEFIRE.load();
				
				$(window).load(function () {
					$("#text-content").val(SCRIBEFIRE.prefs.getCharPref("state.content"));
					SCRIBEFIRE.prefs.setCharPref("state.content", "");
					
					tinyMCE.init({
						// General options
						mode : "exact",
						elements : "text-content",
						theme : "advanced",
						plugins : "wordpress,fullscreen",
						
						// Theme options
						theme_advanced_buttons1 : "fontselect,fontsizeselect,bold,italic,underline,strikethrough,sub,sup,forecolor,blockquote,|,link,unlink,image,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,|,wp_more,fullscreen",//,|,removeformat",//,|,tablecontrols",
						theme_advanced_buttons2 : "", theme_advanced_buttons3 : "", theme_advanced_buttons4 : "",
						theme_advanced_toolbar_location : "top",
						theme_advanced_toolbar_align : "left",
						theme_advanced_statusbar_location : "bottom",
						theme_advanced_resizing : true,
						more_colors_func : false,
						
						// Example content CSS (should be your site CSS)
						content_css : "skin/editor_content.css",
					});
					
					adjustForSize();
				});
				
				$(window).resize(function () {
					clearTimeout(resize_timeout);
					
					resize_timeout = setTimeout(adjustForSize, 100);
				});
				
				$("#main").resize(function () {
					var containerHeight = $(this).height();
					var totalHeight = 0;
					
					$(this).find(" > div").each(function () {
						totalHeight += $(this).height();
					});
					
					var difference = containerHeight - totalHeight;
					
					if (difference > 0) {
						$("#underbar-content").each(function () {
							$(this).height($(this).height() + difference);
						});
					}
				});
			});
			
			var resize_timeout = null;
			
			function adjustForSize() {
				if (platform != "firefox") {
				//	return;
				}
				
				var movableElementsTop = [ "entries", "blogs" ];
				var movableElementsBottom = [ "categories", "tags" ];
				
				var container = "main";
				
				// 915 is the width of the toolbar of the editor.
				if ($(window).width() > 915 && $(window).width() > $(window).height()) {
					// Only add the sidebar when the window is wide enough to show the full editor toolbar
					// and sidebar without a horizontal scroll (and only if it's wider than it is tall).
					container = "sidebar";
				}
				
				if ($("#ui-" + movableElementsTop[0]).parent().attr("id") == container) {
					return;
				}
				
				if (container == "sidebar") {
					$("#sidebar").css("width", "30%");
					$("#main").css("width", "65%");
				}
				else {
					$("#sidebar").css("width", "0%");
					$("#main").css("width", "100%");
				}
				
				for (var i = 0; i < movableElementsBottom.length; i++) {
					var e = $("#ui-" + movableElementsBottom[i]);
				
					e.remove();
				
					$("#" + container).append(e);
				}
				
				for (var i = 0; i < movableElementsTop.length; i++) {
					var e = $("#ui-" + movableElementsTop[i]);
				
					e.remove();
				
					$("#" + container).prepend(e);
				}
				
				if (container == "main") {
					// Default to the height of the editor.
					$("#underbar-content").css("height", null);
				}
			}
		</script>
		<script type="text/javascript" src="lib/platform.js"></script>
	</body>
</html>